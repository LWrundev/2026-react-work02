import{r as c,M as D,j as e,a as i,c as M}from"./bootstrap.esm-BaCeDTGp.js";function R(){const d="https://ec-course-api.hexschool.io/v2",p="devu",h=c.useRef(null),f=c.useRef(null),[b,v]=c.useState({username:"",password:""}),g={title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[""],soldCount:0},[w,x]=c.useState(!1),[U,k]=c.useState([]),[t,u]=c.useState(g),[m,C]=c.useState(""),[B,L]=c.useState(""),y=a=>{const{name:s,value:l}=a.target;v(r=>({...r,[s]:l}))},n=a=>{const{name:s,value:l,checked:r,type:o}=a.target;u(E=>({...E,[s]:o==="checkbox"?r?1:0:o==="number"?Number(l):l}))},I=(a,s)=>{u(l=>{const r=[...l.imagesUrl];return r[a]=s,{...l,imagesUrl:r}})},j=(a,s)=>{u(l=>({...g,...a})),C(s),h.current.show()},$=()=>{h.current.hide()},A=()=>{t.imagesUrl?.length>=5||u(a=>{const s=[...a.imagesUrl];return s.push(""),{...a,imagesUrl:s}})},P=()=>{t.imagesUrl?.length<=1||u(a=>{const s=[...a.imagesUrl];return s.pop(),{...a,imagesUrl:s}})},_=async a=>{a.preventDefault();try{const s=await i.post(`${d}/admin/signin`,b),{token:l,expired:r}=s.data;document.cookie=`myToken=${l};expires=${new Date(r)}`,i.defaults.headers.common.Authorization=l,x(!0)}catch{}},F=async()=>{const a=document.cookie.split("; ").find(s=>s.startsWith("myToken="))?.split("=")[1];if(a)i.defaults.headers.common.Authorization=a;else{x(!1);return}try{(await i.post(`${d}/api/user/check`)).data.success&&(x(!0),N())}catch{x(!1)}},N=async()=>{try{const a=await i.get(`${d}/api/${p}/admin/products`);k(a.data.products)}catch{}},S=async a=>{let s=`${d}/api/${p}/admin/product`,l="post";m==="edit"&&(s=`${d}/api/${p}/admin/product/${a}`,l="put");const r={data:{...t,imagesUrl:[...t.imagesUrl.filter(o=>o!=="")]}};try{const o=await i[l](s,r);N(),h.current.hide(),alert(o.data.message)}catch{}},T=async a=>{try{const s=await i.delete(`${d}/api/${p}/admin/product/${a}`);N(),h.current.hide(),alert(s.data.message)}catch{}};return c.useEffect(()=>{F()},[]),c.useEffect(()=>{h.current=new D(f.current)},[]),e.jsxs(e.Fragment,{children:[w?e.jsx("div",{className:"",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"",children:[e.jsxs("table",{className:"table table-hover table-bordered",children:[e.jsx("thead",{className:"text-center",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"品名"}),e.jsx("th",{scope:"col",children:"類別"}),e.jsx("th",{scope:"col",children:"原價"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"折扣價"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"上架中"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"商品編輯"})]})}),e.jsx("tbody",{className:"table-group-divider",children:U.map(a=>e.jsxs("tr",{className:"align-middle",children:[e.jsx("th",{scope:"row",children:a.title}),e.jsx("td",{className:"text-nowrap text-center",children:a.category}),e.jsx("td",{className:"text-center",children:a.origin_price}),e.jsx("td",{className:"text-center",children:a.price}),e.jsx("td",{className:"text-center",children:a.is_enabled===1?e.jsx("span",{className:"text-bg-success badge",children:"是"}):e.jsx("span",{className:"text-bg-danger badge",children:"否"})}),e.jsxs("td",{className:"text-center",children:[e.jsx("button",{type:"button",className:"btn btn-primary me-2",onClick:()=>j(a,"edit"),children:"編輯"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>j(a,"delete"),children:"刪除"})]})]},a.id))})]}),e.jsx("button",{type:"button",className:"btn btn-outline-primary w-25",onClick:()=>j(g,"create"),children:"新增商品"})]})})}):e.jsxs("div",{className:"my-4 p-4 border rounded w-50 m-auto",children:[e.jsx("h1",{className:"mb-3 h3 text-center",children:"請先登入"}),e.jsxs("form",{action:"",onSubmit:a=>_(a),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"username",className:"form-label",children:"電子信箱"}),e.jsx("input",{type:"text",id:"username",name:"username",autoComplete:"username",className:"form-control",placeholder:"輸入電子信箱",value:b.username,onChange:a=>{y(a)}})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:"密碼"}),e.jsx("input",{type:"password",id:"password",name:"password",className:"form-control",placeholder:"輸入密碼",autoComplete:"current-password",value:b.password,onChange:a=>{y(a)}})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-100",children:"登入"})]})]}),e.jsx("div",{className:"modal fade",id:"modalAddProductTarget",ref:f,"data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"modalAddProductTargetLabel",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{className:`modal-header bg-${m==="delete"?"danger":"secondary"} `,children:e.jsx("h3",{className:"modal-title fs-5 fw-bold text-light",id:"modalAddProductTargetLabel",children:m==="delete"?"刪除商品":m==="create"?"新增商品資訊":"編輯商品資訊"})}),e.jsxs("div",{className:"modal-body",children:[m==="delete"?e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{children:[e.jsx("strong",{children:t.title}),e.jsx("br",{}),"id：",t.id]}),e.jsx("p",{className:"fw-bold",children:"確定要刪除此商品資訊嗎？"})]}):e.jsx("form",{action:"",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"title",className:"form-label",children:"標題"}),e.jsx("input",{type:"text",className:"form-control",id:"title",name:"title",placeholder:"輸入商品標題",value:t.title,onChange:a=>n(a)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"類型"}),e.jsx("input",{type:"text",className:"form-control",id:"category",name:"category",placeholder:"輸入商品類型",value:t.category,onChange:a=>n(a)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"origin_price",className:"form-label",children:"原價"}),e.jsx("input",{type:"number",className:"form-control",id:"origin_price",name:"origin_price",min:"0",placeholder:"輸入商品原價",value:t.origin_price,onChange:a=>n(a)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"優惠價"}),e.jsx("input",{type:"number",className:"form-control",id:"price",name:"price",min:"0",placeholder:"輸入商品優惠價",value:t.price,onChange:a=>n(a)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"unit",className:"form-label",children:"計價單位"}),e.jsx("input",{type:"text",className:"form-control",id:"unit",name:"unit",placeholder:"輸入商品計價單位（件 / 組）",value:t.unit,onChange:a=>n(a)})]}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{name:"is_enabled",id:"is_enabled",className:"form-check-input",type:"checkbox",checked:t.is_enabled===1,onChange:a=>n(a)}),e.jsx("label",{className:"form-check-label",htmlFor:"is_enabled",children:"上架商品"})]})}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"產品描述"}),e.jsx("textarea",{name:"description",id:"description",className:"form-control",placeholder:"請輸入產品描述",value:t.description,onChange:a=>n(a)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"說明內容"}),e.jsx("textarea",{name:"content",id:"content",className:"form-control",placeholder:"請輸入說明內容",value:t.content,onChange:a=>n(a)})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"row row-cols-1 g-3",children:[e.jsxs("div",{className:"col",children:[e.jsx("label",{htmlFor:"imageUrl",className:"form-label",children:"商品主要照片"}),e.jsx("input",{type:"text",className:"form-control",id:"imageUrl",name:"imageUrl",placeholder:"輸入照片網址",value:t.imageUrl,onChange:a=>n(a)}),t.imageUrl&&e.jsx("img",{src:t.imageUrl,className:"img-thumbnail",alt:"主要圖片預覽"})]}),e.jsx("div",{className:"col",children:t.imagesUrl?.map((a,s)=>e.jsxs("div",{className:"mb-3 border p-2",children:[e.jsx("label",{htmlFor:"imagesUrl",className:"form-label",children:"商品次要圖片"}),e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:`請輸入圖片網址 ${s+1}`,value:a,onChange:l=>I(s,l.target.value)}),a&&e.jsx("img",{src:a,alt:`${t.title} - 產品形象照${s+1}`,className:"img-thumbnail w-25"})]},s))}),e.jsxs("div",{className:"btn-group-vertical",role:"group","aria-label":"Vertical button group",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:A,disabled:t.imagesUrl?.length>=5,children:"新增圖片"}),e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:P,disabled:t.imagesUrl?.length<=1,children:"刪除圖片"})]})]})})]})})}),e.jsxs("div",{className:"btn-group w-100 pt-4",role:"group","aria-label":"Basic example",children:[e.jsx("button",{type:"button",className:"btn btn-outline-warning","data-bs-dismiss":"modal",onClick:()=>$(),children:"取消"}),m==="delete"?e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>T(t.id),children:"送出"}):e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>S(t.id),children:"送出"})]})]})]})})})]})}M.createRoot(document.getElementById("w4")).render(e.jsx(c.StrictMode,{children:e.jsx(R,{})}));
