import{r as n,M as D,j as e,a as i,c as M}from"./bootstrap.esm-BaCeDTGp.js";function R(){const d="https://ec-course-api.hexschool.io/v2",p="devu",h=n.useRef(null),N=n.useRef(null),[b,v]=n.useState({username:"",password:""}),f={title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[""]},[w,x]=n.useState(!1),[k,U]=n.useState([]),[l,u]=n.useState({INITIAL_PRODUCT_TEMP:f}),[m,C]=n.useState(""),y=s=>{const{name:a,value:t}=s.target;v(c=>({...c,[a]:t}))},r=s=>{const{name:a,value:t,checked:c,type:o}=s.target;u(E=>({...E,[a]:o==="checkbox"?c?1:0:o==="number"?Number(t):t})),console.log(a,t)},$=(s,a)=>{u(t=>{const c=[...t.imagesUrl];return c[s]=a,{...t,imagesUrl:c}})},g=(s,a)=>{u(t=>({...t,...s})),C(a),h.current.show()},A=()=>{h.current.hide()},I=()=>{l.imagesUrl?.length>=5||u(s=>{const a=[...s.imagesUrl];return a.push(""),{...s,imagesUrl:a}})},P=()=>{l.imagesUrl?.length<=1>5||u(s=>{const a=[...s.imagesUrl];return a.pop(),{...s,imagesUrl:a}})},_=async s=>{s.preventDefault();try{const a=await i.post(`${d}/admin/signin`,b),{token:t,expired:c}=a.data;document.cookie=`myToken=${t};expires=${new Date(c)}`,i.defaults.headers.common.Authorization=t,x(!0),console.log(a)}catch(a){console.log(a)}},F=async()=>{const s=document.cookie.split("; ").find(a=>a.startsWith("myToken="))?.split("=")[1];if(s)i.defaults.headers.common.Authorization=s;else{x(!1);return}try{const a=await i.post(`${d}/api/user/check`);console.log(a),a.data.success&&(x(!0),j())}catch(a){console.log(a),x(!1)}},j=async()=>{try{const s=await i.get(`${d}/api/${p}/admin/products`);U(s.data.products),console.log(s.data.products)}catch(s){console.log(s)}},T=async s=>{let a=`${d}/api/${p}/admin/product`,t="post";m==="edit"&&(a=`${d}/api/${p}/admin/product/${s}`,t="put");const c={data:{...l,imagesUrl:[...l.imagesUrl.filter(o=>o!=="")]}};try{const o=await i[t](a,c);j(),h.current.hide(),alert(o.data.message)}catch(o){console.log(o)}},S=async s=>{try{const a=await i.delete(`${d}/api/${p}/admin/product/${s}`);console.log(a.data.message),j(),h.current.hide(),alert(a.data.message)}catch(a){console.log(a)}};return n.useEffect(()=>{F()},[]),n.useEffect(()=>{h.current=new D(N.current)},[]),e.jsxs(e.Fragment,{children:[w?e.jsx("div",{className:"container my-3",children:e.jsx("div",{className:"",children:e.jsxs("div",{className:"",children:[e.jsxs("table",{className:"table table-hover table-bordered",children:[e.jsx("thead",{className:"text-center",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"品名"}),e.jsx("th",{scope:"col",children:"類別"}),e.jsx("th",{scope:"col",children:"原價"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"折扣價"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"上架中"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"商品編輯"})]})}),e.jsx("tbody",{className:"table-group-divider",children:k.map(s=>e.jsxs("tr",{className:"align-middle",children:[e.jsx("th",{scope:"row",children:s.title}),e.jsx("td",{className:"text-nowrap text-center",children:s.category}),e.jsx("td",{className:"text-center",children:s.origin_price}),e.jsx("td",{className:"text-center",children:s.price}),e.jsx("td",{className:"text-center",children:s.is_enabled===1?e.jsx("span",{className:"text-bg-success badge",children:"是"}):e.jsx("span",{className:"text-bg-danger badge",children:"否"})}),e.jsxs("td",{className:"text-center",children:[e.jsx("button",{type:"button",className:"btn btn-primary me-2",onClick:()=>g(s,"edit"),children:"編輯"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>g(s,"delete"),children:"刪除"})]})]},s.id))})]}),e.jsx("button",{type:"button",className:"btn btn-outline-primary w-25",onClick:()=>g(f,"create"),children:"新增商品"})]})})}):e.jsxs("div",{className:"my-4 p-4 border rounded w-50 m-auto",children:[e.jsx("h1",{className:"mb-3 h3 text-center",children:"請先登入"}),e.jsxs("form",{action:"",onSubmit:s=>_(s),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"username",className:"form-label",children:"電子信箱"}),e.jsx("input",{type:"text",id:"username",name:"username",autoComplete:"username",className:"form-control",placeholder:"輸入電子信箱",value:b.username,onChange:s=>{y(s)}})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:"密碼"}),e.jsx("input",{type:"password",id:"password",name:"password",className:"form-control",placeholder:"輸入密碼",autoComplete:"current-password",value:b.password,onChange:s=>{y(s)}})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-100",children:"登入"})]})]}),e.jsx("div",{className:"modal fade",id:"modalAddProductTarget",ref:N,"data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"modalAddProductTargetLabel",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{className:`modal-header bg-${m==="delete"?"danger":"secondary"} `,children:e.jsx("h3",{className:"modal-title fs-5 fw-bold text-light",id:"modalAddProductTargetLabel",children:m==="delete"?"刪除商品":m==="create"?"新增商品資訊":"編輯商品資訊"})}),e.jsxs("div",{className:"modal-body",children:[m==="delete"?e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{children:[e.jsx("strong",{children:l.title}),e.jsx("br",{}),"id：",l.id]}),e.jsx("p",{className:"fw-bold",children:"確定要刪除此商品資訊嗎？"})]}):e.jsx("form",{action:"",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"title",className:"form-label",children:"標題"}),e.jsx("input",{type:"text",className:"form-control",id:"title",name:"title",placeholder:"輸入商品標題",value:l.title,onChange:s=>r(s)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"類型"}),e.jsx("input",{type:"text",className:"form-control",id:"category",name:"category",placeholder:"輸入商品類型",value:l.category,onChange:s=>r(s)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"origin_price",className:"form-label",children:"原價"}),e.jsx("input",{type:"number",className:"form-control",id:"origin_price",name:"origin_price",min:"0",placeholder:"輸入商品原價",value:l.origin_price,onChange:s=>r(s)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"優惠價"}),e.jsx("input",{type:"number",className:"form-control",id:"price",name:"price",min:"0",placeholder:"輸入商品優惠價",value:l.price,onChange:s=>r(s)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"unit",className:"form-label",children:"計價單位"}),e.jsx("input",{type:"text",className:"form-control",id:"unit",name:"unit",placeholder:"輸入商品計價單位（件 / 組）",value:l.unit,onChange:s=>r(s)})]}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{name:"is_enabled",id:"is_enabled",className:"form-check-input",type:"checkbox",checked:l.is_enabled===1,onChange:s=>r(s)}),e.jsx("label",{className:"form-check-label",htmlFor:"is_enabled",children:"上架商品"})]})}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"產品描述"}),e.jsx("textarea",{name:"description",id:"description",className:"form-control",placeholder:"請輸入產品描述",value:l.description,onChange:s=>r(s)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"說明內容"}),e.jsx("textarea",{name:"content",id:"content",className:"form-control",placeholder:"請輸入說明內容",value:l.content,onChange:s=>r(s)})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"row row-cols-1 g-3",children:[e.jsxs("div",{className:"col",children:[e.jsx("label",{htmlFor:"imageUrl",className:"form-label",children:"商品主要照片"}),e.jsx("input",{type:"text",className:"form-control",id:"imageUrl",name:"imageUrl",placeholder:"輸入照片網址",value:l.imageUrl,onChange:s=>r(s)}),l.imageUrl&&e.jsx("img",{src:l.imageUrl,className:"img-thumbnail",alt:"主要圖片預覽"})]}),e.jsx("div",{className:"col",children:l.imagesUrl?.map((s,a)=>e.jsxs("div",{className:"mb-3 border p-2",children:[e.jsx("label",{htmlFor:"imagesUrl",className:"form-label",children:"商品次要圖片"}),e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:`請輸入圖片網址 ${a+1}`,value:s,onChange:t=>$(a,t.target.value)}),s&&e.jsx("img",{src:s,alt:`${l.title} - 產品形象照${a+1}`,className:"img-thumbnail w-25"})]},a))}),e.jsxs("div",{className:"btn-group-vertical",role:"group","aria-label":"Vertical button group",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:I,disabled:l.imagesUrl?.length>=5,children:"新增圖片"}),e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:P,disabled:l.imagesUrl?.length<=1,children:"刪除圖片"})]})]})})]})})}),e.jsxs("div",{className:"btn-group w-100 pt-4",role:"group","aria-label":"Basic example",children:[e.jsx("button",{type:"button",className:"btn btn-outline-warning","data-bs-dismiss":"modal",onClick:()=>A(),children:"取消"}),m==="delete"?e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>S(l.id),children:"送出"}):e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>T(l.id),children:"送出"})]})]})]})})})]})}M.createRoot(document.getElementById("w3")).render(e.jsx(n.StrictMode,{children:e.jsx(R,{})}));
