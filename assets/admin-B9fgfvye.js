import{j as e,r as i,M as B,a as u,c as z}from"./bootstrap.esm-BaCeDTGp.js";function H({products:o,handleProductModalShow:r}){return e.jsx(e.Fragment,{children:e.jsxs("table",{className:"table table-hover table-bordered",children:[e.jsx("thead",{className:"text-center",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"品名"}),e.jsx("th",{scope:"col",children:"類別"}),e.jsx("th",{scope:"col",children:"原價"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"折扣價"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"上架中"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"已售出數量"}),e.jsx("th",{scope:"col",className:"text-nowrap",children:"商品編輯"})]})}),e.jsx("tbody",{className:"table-group-divider",children:o.map(s=>e.jsxs("tr",{className:"align-middle",children:[e.jsx("th",{scope:"row",children:s.title}),e.jsx("td",{className:"text-nowrap text-center",children:s.category}),e.jsx("td",{className:"text-center",children:s.origin_price}),e.jsx("td",{className:"text-center",children:s.price}),e.jsx("td",{className:"text-center",children:s.is_enabled===1?e.jsx("span",{className:"text-bg-success badge",children:"是"}):e.jsx("span",{className:"text-bg-danger badge",children:"否"})}),e.jsx("td",{className:"text-center",children:s.soldCount}),e.jsxs("td",{className:"text-center",children:[e.jsx("button",{type:"button",className:"btn btn-primary me-2",onClick:()=>r(s,"edit"),children:"編輯"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>r(s,"delete"),children:"刪除"})]})]},s.id))})]})})}function K({signinData:o,handleInputSingin:r,login:s}){return e.jsx(e.Fragment,{children:e.jsxs("form",{action:"",onSubmit:n=>s(n),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"username",className:"form-label",children:"電子信箱"}),e.jsx("input",{type:"text",id:"username",name:"username",autoComplete:"username",className:"form-control",placeholder:"輸入電子信箱",value:o.username,onChange:n=>{r(n)}})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:"password",className:"form-label",children:"密碼"}),e.jsx("input",{type:"password",id:"password",name:"password",className:"form-control",placeholder:"輸入密碼",autoComplete:"current-password",value:o.password,onChange:n=>{r(n)}})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-100",children:"登入"})]})})}function O({modalAddProductTarget:o,modalType:r,temp:s,handleProductInput:n,handleImgInput:b,handleAddImg:j,handleDelImg:p,handleAddProductHide:N,delProduct:g,updateProduct:f}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:"modal fade",ref:o,"data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"modalAddProductTargetLabel",children:e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{className:`modal-header bg-${r==="delete"?"danger":"secondary"} `,children:e.jsx("h3",{className:"modal-title fs-5 fw-bold text-light",id:"modalAddProductTargetLabel",children:r==="delete"?"刪除商品":r==="create"?"新增商品資訊":"編輯商品資訊"})}),e.jsxs("div",{className:"modal-body",children:[r==="delete"?e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{children:[e.jsx("strong",{children:s.title}),e.jsx("br",{}),"id：",s.id]}),e.jsx("p",{className:"fw-bold",children:"確定要刪除此商品資訊嗎？"})]}):e.jsx("form",{action:"",children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"title",className:"form-label",children:"標題"}),e.jsx("input",{type:"text",className:"form-control",id:"title",name:"title",placeholder:"輸入商品標題",value:s.title,onChange:t=>n(t)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"類型"}),e.jsx("input",{type:"text",className:"form-control",id:"category",name:"category",placeholder:"輸入商品類型",value:s.category,onChange:t=>n(t)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"origin_price",className:"form-label",children:"原價"}),e.jsx("input",{type:"number",className:"form-control",id:"origin_price",name:"origin_price",min:"0",placeholder:"輸入商品原價",value:s.origin_price,onChange:t=>n(t)})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"優惠價"}),e.jsx("input",{type:"number",className:"form-control",id:"price",name:"price",min:"0",placeholder:"輸入商品優惠價",value:s.price,onChange:t=>n(t)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"unit",className:"form-label",children:"計價單位"}),e.jsx("input",{type:"text",className:"form-control",id:"unit",name:"unit",placeholder:"輸入商品計價單位（件 / 組）",value:s.unit,onChange:t=>n(t)})]}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{name:"is_enabled",id:"is_enabled",className:"form-check-input",type:"checkbox",checked:s.is_enabled===1,onChange:t=>n(t)}),e.jsx("label",{className:"form-check-label",htmlFor:"is_enabled",children:"上架商品"})]})}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"soldCount",className:"form-label",children:"已售出數量"}),e.jsx("input",{type:"number",className:"form-control",id:"soldCount",name:"soldCount",min:"0",placeholder:"輸入商品優惠價",value:s.soldCount,onChange:t=>n(t)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"產品描述"}),e.jsx("textarea",{name:"description",id:"description",className:"form-control",placeholder:"請輸入產品描述",value:s.description,onChange:t=>n(t)})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"說明內容"}),e.jsx("textarea",{name:"content",id:"content",className:"form-control",placeholder:"請輸入說明內容",value:s.content,onChange:t=>n(t)})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"row row-cols-1 g-3",children:[e.jsxs("div",{className:"col",children:[e.jsx("label",{htmlFor:"imageUrl",className:"form-label",children:"商品主要照片"}),e.jsx("input",{type:"text",className:"form-control",id:"imageUrl",name:"imageUrl",placeholder:"輸入照片網址",value:s.imageUrl,onChange:t=>n(t)}),s.imageUrl&&e.jsx("img",{src:s.imageUrl,className:"img-thumbnail",alt:"主要圖片預覽"})]}),e.jsx("div",{className:"col",children:s.imagesUrl?.map((t,d)=>e.jsxs("div",{className:"mb-3 border p-2",children:[e.jsx("label",{htmlFor:"imagesUrl",className:"form-label",children:"商品次要圖片"}),e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:`請輸入圖片網址 ${d+1}`,value:t,onChange:x=>b(d,x.target.value)}),t&&e.jsx("img",{src:t,alt:`${s.title} - 產品形象照${d+1}`,className:"img-thumbnail w-25"})]},d))}),e.jsxs("div",{className:"btn-group-vertical",role:"group","aria-label":"Vertical button group",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary",onClick:j,disabled:s.imagesUrl?.length>=5,children:"新增圖片"}),e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:p,disabled:s.imagesUrl?.length<=1,children:"刪除圖片"})]})]})})]})})}),e.jsxs("div",{className:"btn-group w-100 pt-4",role:"group","aria-label":"Basic example",children:[e.jsx("button",{type:"button",className:"btn btn-outline-warning","data-bs-dismiss":"modal",onClick:()=>N(),children:"取消"}),r==="delete"?e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>g(s.id),children:"送出"}):e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>f(s.id),children:"送出"})]})]})]})})})})}function V(){const o="https://ec-course-api.hexschool.io/v2",r="devu",s=i.useRef(null),n=i.useRef(null),[b,j]=i.useState({username:"",password:""}),p={title:"",category:"",origin_price:0,price:0,unit:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[""],soldCount:0},[N,g]=i.useState(!1),[f,t]=i.useState([]),[d,x]=i.useState(p),[v,U]=i.useState(""),[w,k]=i.useState(""),F=l=>{const{name:a,value:c}=l.target;j(m=>({...m,[a]:c}))},$=l=>{const{name:a,value:c,checked:m,type:h}=l.target;x(L=>({...L,[a]:h==="checkbox"?m?1:0:h==="number"?Number(c):c})),console.log(a,c)},A=(l,a)=>{x(c=>{const m=[...c.imagesUrl];return m[l]=a,{...c,imagesUrl:m}})},C=(l,a)=>{x(c=>({...p,...l})),U(a),s.current.show()},_=()=>{s.current.hide()},I=()=>{d.imagesUrl?.length>=5||x(l=>{const a=[...l.imagesUrl];return a.push(""),{...l,imagesUrl:a}})},S=()=>{d.imagesUrl?.length<=1||x(l=>{const a=[...l.imagesUrl];return a.pop(),{...l,imagesUrl:a}})},D=async l=>{l.preventDefault();try{const a=await u.post(`${o}/admin/signin`,b),{token:c,expired:m}=a.data;document.cookie=`myToken=${c};expires=${new Date(m)}`,u.defaults.headers.common.Authorization=c,g(!0),console.log(a)}catch(a){console.log(a)}},E=async()=>{const l=document.cookie.split("; ").find(a=>a.startsWith("myToken="))?.split("=")[1];if(l)u.defaults.headers.common.Authorization=l;else{g(!1);return}try{const a=await u.post(`${o}/api/user/check`);console.log(a),a.data.success&&(g(!0),y())}catch(a){console.log(a),g(!1)}},y=async()=>{try{const l=await u.get(`${o}/api/${r}/admin/products`);t(l.data.products),console.log(l.data.products)}catch(l){console.log(l)}},T=async l=>{let a=`${o}/api/${r}/admin/product`,c="post";v==="edit"&&(a=`${o}/api/${r}/admin/product/${l}`,c="put");const m={data:{...d,imagesUrl:[...d.imagesUrl.filter(h=>h!=="")]}};try{const h=await u[c](a,m);y(),s.current.hide(),alert(h.data.message)}catch(h){console.log(h)}},M=async l=>{try{const a=await u.delete(`${o}/api/${r}/admin/product/${l}`);console.log(a.data.message),y(),s.current.hide(),alert(a.data.message)}catch(a){console.log(a)}},P=l=>{k(l.target.files[0]),console.log(l.target.files[0])},R=async l=>{if(l.preventDefault(),!w)return;const a=new FormData;a.append("file-to-upload",w);try{const c=await u.post(`${o}/api/${r}/admin/upload`,a,{headers:{"content-type":"multipart/form-data"}});console.log(c)}catch(c){console.log(c)}};return i.useEffect(()=>{E()},[]),i.useEffect(()=>{s.current=new B(n.current)},[]),e.jsxs(e.Fragment,{children:[N?e.jsx("div",{className:"container my-3",children:e.jsx("div",{className:"",children:e.jsxs("div",{className:"",children:[e.jsx(H,{products:f,handleProductModalShow:C}),e.jsx("button",{type:"button",className:"btn btn-outline-primary w-25",onClick:()=>C(p,"create"),children:"新增商品"}),e.jsxs("form",{className:"my-4",children:[e.jsx("input",{type:"file",name:"file-to-upload",className:"form-control mb-3",accept:".jpg,.jpeg,.png",onChange:P}),e.jsx("input",{type:"submit",value:"Upload",className:"btn btn-primary",onClick:R})]})]})})}):e.jsxs("div",{className:"my-4 p-4 border rounded w-50 m-auto",children:[e.jsx("h1",{className:"mb-3 h3 text-center",children:"請先登入"}),e.jsx(K,{signinData:b,handleInputSingin:F,login:D})]}),e.jsx(O,{modalAddProductTarget:n,modalType:v,temp:d,handleProductInput:$,handleImgInput:A,handleAddImg:I,handleDelImg:S,handleAddProductHide:_,delProduct:M,updateProduct:T})]})}z.createRoot(document.getElementById("w3")).render(e.jsx(i.StrictMode,{children:e.jsx(V,{})}));
